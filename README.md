# 499 - Summer Project

## Timeline of Project
<p>
    <center><img src="/design/schedule1.png" width="100%;" height="100%;" alt/></center>
</p>

## Scope & Motivation

The goal of this project was to design an MRI-compatible device to provide a sensory stimulus. The sensory signal generated from the stimulus will be traced using functional magnetic resonance imaging (fMRI). In individuals who have experienced a stroke this pathway is disrupted and can inhibit sensorimotor function. Tracing the sensory signal can help determine if the cause is from the signal not reaching the brain, or how the signal is processed once it reaches the brain.

## Sensory Stimulation

#### Overview

The somatosenory system is the mechanism by which the body interprets touch, pressure, temperature, proprioception, and pain, through a route called the Dorsal Column-Medial Lemniscal pathway. Receptors in the body transduce sensory information and send it upstream to the Dorsal Root Ganglion in the spinal column. It travels up the spine, crosses in the medulla, passes through the midbrain, and finally terminates at the somatosensory cortex. The crossing in the medulla is why a stroke in the right hemisphere of the brain affects the left side of the body, and vice versa.

<p>
    <center><img src="/design/dcml.png" width="80%;" height="100%;" alt/>
    <br>
    <em>Figure 2: The dorsal column-medial lemniscus (DCML) pathway</em></center>
</p>

In order to provide a stimulation itâ€™s important to understand how/which sort of stimulus is received and processed. Information is transduced via 4 mechanoreceptors, each with their own specialization<sup>[1]</sup>; Merkel cells for pressure, Meissner Corpuscles for surface textures, Ruffini Corpuscles for proprioception (stretch reflex), and Pacinian Corpuscles that are sensitive to vibrations. While it's impractical to separate the signals generated by each receptor, at least in the scope of this project, Merkel cell excitation guided the design.

<p>
    <center><img src="/design/receptors.png" width="100%;" height="100%;" alt/>
    <br>
    <em>Figure 3: Receptors in the fingertip and the information they transduce</em></center>
</p>

Merkel cells are sensitive to pressure and are slow adapting cells, meaning they have a sustained response to stimulus. They respond in the 0-100 Hz range, with peak sensitivity at a fluttery 5 Hz. The indentation threshold is very low, on the order of micrometers. For the purposes of design the assumption was made that <i>any</i> contact with the finger tip was an effective stimuli. The device also needs to limit the maximum force to 5N, based on a similar study investigating the encoding of direction of fingertip forces.<sup>[[2]](https://pubmed.ncbi.nlm.nih.gov/11588194/)</sup>

<p>
    <center><img src="/design/receptor_chart.png" width="100%;" height="100%;" alt/>
    <br>
    <em>Figure 4: Sensitivity information about the receptors</em></center>
</p>

It's also important to understand how forces (or pressure) travels through the finger. Figure 5 demonstrates what happens to the tissue in the finger tip; pressure applied at the finger tip causes veins in the tissue to be compressed. This tissue compression is how the Merkel cells are stimulated. The fingernail is intrinsically part of the force-load structure of the fingertip; "Slowly adapting type I afferents from the sides and end of the finger respond to stimuli on the center of the fingerpad."<sup>[[3]](https://my.mech.utah.edu/~smascaro/pdf/Mascaro-2002-Haptics-NailBone.pdf)</sup>

<p>
    <center><img src="/design/squish.png" width="100%;" height="100%;" alt/>
    <br>
    <em>Figure 5: Normal force applied to finger tip</em></center>
</p>

## Apparatus

### System Design

Because the device will be in MRI environment, special consideration was needed to the materials used. First, metals need to be nonferromagnetic, such as brass or aluminum. Conductive materials (including the body) are also subject to RF heating from the electromagnetic field. Second, whatever is controlling the system will need to be placed outside of the scanner room unless shielded.

Piezoelectric and ultrasonic motors are able to operate in the MRI environment, however they cannot actuate during the imaging process otherwise it creates artifacts in the image.<sup>[[4]](https://pubmed.ncbi.nlm.nih.gov/18982643/)</sup> There are methods that address this issue<sup>[[5]](https://pubmed.ncbi.nlm.nih.gov/19964890/)</sup> but fall out of the scope of the project.

<p>
    <center><img src="/design/snr.jpg" width="80%;" height="50%;" alt/>
    <br>
    <em>Figure 6: SNR results under 3T imaging</em></center>
</p>

Pneumatic and hydraulic systems can also work in MRI environments, potentially being completely free of any EMF radiation. Pneumatic systems use air as a working fluid, which is compressible. Hydraulic systems use oil or some other liquid as a working fluid, which risks leaking. To work in the MRI room, the fittings also have to be made from plastic, brass, etc. Likewise, the working fluid also has to be safe.

Mechanical devices can still be used if the proper precautions are made, but ultimately makes it a larger design problem than it needs to be.

I chose to go with a pneumatic system for three reasons; 1) it's inherently free of any metal, plastic hardware is readily available and commonly used, 2) you can infer the force applied by the piston if you know the dimensions of the piston, and 3) it eliminates leakage as a concern, since fabrication and testing would take place in my apartment.

### Pneumatic Actuator

To create the sensory signal I developed a small piston that presses on the finger. The piston is 3D printed using PLA polymer and is attached to an air compressor for pneumatic action. It's controlled using a PIC32 microcontroller and a pressure sensor. Two variations of the piston were developed; a pneumatic return (how the piston resets itself) and a spring return. More information about the design can be found [here](https://github.com/alexanderhay2020/499/tree/master/summer_project/design).

<p>
    <center><img src="/design/cutaway.png" width="80%;" height="50%;" alt/>
    <br>
    <em>Figure 4: Cross section of the pneumatic actuator</em></center>
</p>

Air is directed in and out of the piston using a solenoid controlled by the PIC32 microcontroller. The solenoid has three (3) positions; allowing airflow to the cylinder, allowing airflow from the cylinder, and a neutral position that restricts all airflow.

<p>
  <center>
    <a href="https://www.lunchboxsessions.com/materials/flow-directional-control-valves/directional-control-valve-simulation"><img src="/design/left-open.gif" width="40%;" height="100%;" style="margin-right:50px;"></a>
    <a href="https://www.lunchboxsessions.com/materials/flow-directional-control-valves/directional-control-valve-simulation"><img src="/design/right-open.gif" width="40%;" height="100%;"></a>
    <br>
    <em>Figure 5: Solenoid directing airflow. Graphic source: lunchboxsessions.com</em>
  </center>
</p>

### Control Device

The PIC32 communicates with the pressure sensor using one of the analog input pins. A voltage divider (not shown) brings the max voltage from the sensor from 5v down to a more tolerable 3.3V. The PIC's analog-to-digital converter (ADC) converts the analog voltage into a digital signal. Configuration of the ADC for this project can be found [here](https://github.com/alexanderhay2020/499_pneumatic/blob/master/firmware/src/adc.c). System status is displayed to a 320x240 LCD touchscreen. It monitors system pressure, sensor frequency, serial communications, and touch sensitivity, and can graph sensor data in real time.

<p>
    <center><img src="/design/circuit.png" width="80%;" height="50%;" alt/>
    <br>
    <em>Figure 5: Circuit diagram of the system</em></center>
</p>

The solenoid operates at 120V and needed its own circuit. To control that circuit I used a relay module. This allows the PIC to control the 120V solenoid while still operating at 3.3V. Powered by its own 5V source, a command signal is sent to the relay module from the PIC. Energizing the solenoid to close the 120V circuit draws a lot of current, so the relay module should have it's own power supply.

I designed plastic housings for the circuit components, which served three purposes; first, it addressed an important safety concern. The solenoid requires 120V, which is controlled by the relay. It doesn't need to be spelled out why 120V passing through an exposed connection is a bad idea. Second, it made me address the question "given the same resources, could someone else build this device?" Staring at a breadboard that looked like a gutted telephone box, I knew I had to do something. And thirdly, it helped focus the design. With each iteration I was able to consolidate connections, reduce circuit complexity, address hardware bug, and face UI/UX head-on. "Is this a usable device, or something I've stared too long at?" "Given the device, could they assemble it without instructions?"

### Version Control

As development continued it became increasingly important to track changes. Each peripheral had its own dedicated branch. Being the sole developer made development rather linear, but it provided a good opportunity to flex some git knowledge and pick up new tricks, like `git stash` and `git stash pop`. Working peripherals were then merged into the main branch. This project also demonstrated how important version control is for CAD! It was easy to take for granted how convenient git made working on the firmware. Moving forward, I'd like to utilize a revision system for the associated CAD designs.

## Future work

During development I made it a priority that the device was MRI-compatible, which influenced many of the design considerations and challenges. The decision to use a pneumatic system made it so there is no interference from the apparatus during the MR imaging process. However, air is a compressible fluid which makes it difficult to control. A hydraulic system was considered to address that but was never implemented due to concerns about leakage.

The control loop, as it is currently, only uses a pressure sensor to infer force applied by the piston, and is only feed-forward. To close the control loop, an optical linear encoder using fiber optic cables was considered, but ultimately shelved due to time constraints.

Knowing if/when the piston engages with the finger is also important. The PIC32 microcontroller has a peripheral called the Charge Time Measurement Unit (CTMU), allowing for capacitive touch sensing. For it to work, the surface that the fingertip engages with must be conductive (and MRI-compatible, ie. aluminum foil) for it to work. Studies examining the heating effects of MRI scanning have shown that no significant heating occurs with nonferromagnetic materials.<sup>[[2]](https://onlinelibrary.wiley.com/doi/abs/10.1002/mrm.1910070302?sid=nlm%3Apubmed)</sup> This means the individual won't risk burning their finger. And because the peripheral is non-moving, there's no risk of interference during imaging<sup>[[3]](https://pubmed.ncbi.nlm.nih.gov/18982643/)</sup>.

## References

[1] Purves, D., Augustine, G., Fitzpatrick, D., Hall, W., LaMantia, A., Mooney, R., Platt, M. and White, L., 2018. Neuroscience. 6th ed.

[2] Birznieks I, Jenmalm P, Goodwin AW, Johansson RS. Encoding of direction of fingertip forces by human tactile afferents. J Neurosci. 2001;21(20):8222-8237. doi:10.1523/JNEUROSCI.21-20-08222.2001

[3] Mascaro S, Asada H. Understanding of fingernail-bone interaction and fingertip hemodynamics for fingernail sensor design. Proceedings 10th Symposium on Haptic Interfaces for Virtual Environment and Teleoperator Systems HAPTICS 2002. 2002. doi:10.1109/haptic.2002.998948

[4] Fischer GS, Krieger A, Iordachita I, Csoma C, Whitcomb LL, Gabor F. MRI compatibility of robot actuation techniques--a comparative study. Med Image Comput Comput Assist Interv. 2008;11(Pt 2):509-517. doi:10.1007/978-3-540-85990-1_61

[5] Wang Y, Cole GA, Su H, Pilitsis JG, Fischer GS. MRI compatibility evaluation of a piezoelectric actuator system for a neural interventional robot. Conf Proc IEEE Eng Med Biol Soc. 2009;2009:6072-6075. doi:10.1109/IEMBS.2009.5334206

[x] Buchli R, Boesiger P, Meier D. Heating effects of metallic implants by MRI examinations. Magn Reson Med. 1988;7(3):255-261. doi:10.1002/mrm.1910070302
